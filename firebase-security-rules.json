{
  "rules": {
    // ðŸ”’ ENHANCED SECURITY RULES untuk Firebase Realtime Database
    // Dikombinasikan dengan Cloud Functions validation

    // ============================================
    // 1. CONTENT DATA (Shop, Archive, Gallery)
    // ============================================
    "content": {
      // Everyone can read content
      ".read": true,
      
      // Only Cloud Functions (backend) can write
      ".write": false,
      
      "shop": {
        "$productId": {
          // Validate product structure
          ".validate": "newData.hasChildren(['name', 'price']) && newData.child('price').val() > 0 && newData.child('price').val() < 1000000"
        }
      },
      
      "archive": {
        "$itemId": {
          ".validate": "newData.hasChildren(['name', 'price'])"
        }
      },
      
      "gallery": {
        "$itemId": {
          ".validate": "newData.hasChildren(['title', 'imageUrl'])"
        }
      }
    },

    // ============================================
    // 2. ADMIN CONFIGURATION
    // ============================================
    "adminConfig": {
      // Only admins can read
      ".read": "auth != null && root.child('admins').child(auth.uid).exists()",
      
      // Only Cloud Functions can write
      ".write": false,
      
      "passwordHash": {
        ".validate": "newData.isString() && newData.val().length > 50"
      }
    },

    // ============================================
    // 3. ADMIN SESSIONS
    // ============================================
    "adminSessions": {
      $sessionToken: {
        // Admin can read their own sessions
        ".read": "auth != null && root.child('admins').child(auth.uid).exists()",
        
        // Only Cloud Functions can write
        ".write": false,
        
        ".validate": "newData.hasChildren(['createdAt', 'ipAddress']) && newData.child('expiresAt').val() > now"
      }
    },

    // ============================================
    // 4. AUDIT LOGS (immutable)
    // ============================================
    "auditLogs": {
      // Only admins can read
      ".read": "auth != null && root.child('admins').child(auth.uid).exists()",
      
      // Only Cloud Functions can write (append-only)
      ".write": false,
      
      $logId: {
        ".validate": "newData.hasChildren(['action', 'timestamp']) && !data.exists()"
      }
    },

    // ============================================
    // 5. FEEDBACK (public submission, protected by rate limit)
    // ============================================
    "feedback": {
      // Only admins can read
      ".read": "auth != null && root.child('admins').child(auth.uid).exists()",
      
      // Only Cloud Functions can write (rate limited)
      ".write": false,
      
      $feedbackId: {
        ".validate": "newData.hasChildren(['email', 'message', 'submittedAt']) && newData.child('message').val().length > 10 && newData.child('message').val().length < 5000"
      }
    },

    // ============================================
    // 6. ADMIN LIST (read-only)
    // ============================================
    "admins": {
      // Only admins can read list
      ".read": "auth != null && root.child('admins').child(auth.uid).exists()",
      
      // No direct writes (managed by admin)
      ".write": false
    },
  }
}
